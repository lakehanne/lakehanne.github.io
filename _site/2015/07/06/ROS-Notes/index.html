<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>ROS Notes</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="Towards an autonomous future.">
    <link rel="canonical" href="lakehanne.github.io/2015/07/06/ROS-Notes/">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-3698471-23', 'auto');
      ga('send', 'pageview');
    </script>

</head>


    <body>

    <header class="site-header">

  <div class="wrap">

    <div style="float:left; margin-top:10px; margin-right:10px;">
    <a href="/feed.xml">
      <img src="/downloads/rssicon.svg" width="40">
    </a>
    </div>

    <a class="site-title" href="/">Olalekan Ogunmolu</a>
    
    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
           viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
          <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
            h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
            h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
            c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">
        
          <a class="page-link" href="/about/">About</a>
        
          
        
          <a class="page-link" href="/">Olalekan Ogunmolu</a>
        
          <a class="page-link" href="/Pubs/">Papers</a>
        
      </div>
    </nav>
  </div>

</header>


    <div class="page-content">
      <div class="wrap">

      <div class="post">

  <header class="post-header">
    <h1>ROS Notes</h1>
    <p class="meta">Jul 6, 2015</p>
  </header>

  <article class="post-content">
  <blockquote>
<p><strong>NOTE:</strong> This is still a workin progress developed while learning ROS. You would find some lines that are duplicated on the <a href="http://wiki.ros.org/">ros wiki pages</a> but this is meant to give you a brief and hit and run overview of ROS if you are new to the ROS environment. Most of these instructions are only useful if you are running Linux as I do most of my coding in sublime-text2 on Ubuntu 14.04.2 LTS (Ubuntu trusty).</p>
</blockquote>

<p>The most common way of starting a roscpp node is by creating a <code>ros::NodeHandle</code>:</p>

<p><pre class="terminal"><code>$ ros::NodeHandle nh; </code></pre></p>

<p>When the first <code>ros::NodeHandle</code> is created it will call <code>ros::start()</code>, and when the last <code>ros::NodeHandle</code> is destroyed, it will call <code>ros::shutdown()</code>. If you want to manually manage the lifetime of the node you may call <code>ros::start()</code> yourself, in which case you should call <code>ros::shutdown()</code> before your program exits.</p>

<h3>Shutting Down the Node</h3>

<p>At any time you may call the <code>ros::shutdown()</code> function to shutdown your node. This will kill all open subscriptions, publications, service calls, and service servers.</p>

<p>By default <code>roscpp</code> also installs a <code>SIGINT</code> handler which will detect Ctrl-C and automatically shutdown for you.</p>

<p><strong>Testing for Shutdown</strong>
There are two methods to check for various states of shutdown. The most common is <code>ros::ok()</code>. Once <code>ros::ok()</code> returns false, the node has finished shutting down. A common use of <code>ros::ok():</code></p>
<div class="highlight"><pre><code class="language-c++" data-lang="c++">    <span class="k">while</span> <span class="p">(</span><span class="n">ros</span><span class="o">::</span><span class="n">ok</span><span class="p">())</span>
      <span class="p">{</span>
        <span class="p">...</span>
      <span class="p">}</span>
</code></pre></div>
<p>The other method to check for shutdown is the <code>ros::isShuttingDown()</code> method. This method will turn true as soon as <code>ros::shutdown()</code> is called, not when it is done. Use of <code>ros::isShuttingDown()</code> is generally discouraged, but can be useful in advanced cases. For example, to test inside of a prolonged service callback whether the node is requested to shut down and the callback should therefore quit now, <code>ros::isShuttingDown()</code> is needed. <code>ros::ok()</code> would not work here because the node can&#39;t finish its shutdown as long as the callback is running.</p>

<h4>Custom SIGINT Handler</h4>

<p>You can install a custom <strong>SIGINT</strong> handler that plays nice with ROS like so:</p>
<div class="highlight"><pre><code class="language-c++" data-lang="c++">  <span class="cp">#include &lt;ros/ros.h&gt;</span>
  <span class="cp">#include &lt;signal.h&gt;</span>

  <span class="kt">void</span> <span class="nf">mySigintHandler</span><span class="p">(</span><span class="kt">int</span> <span class="n">sig</span><span class="p">)</span>
   <span class="p">{</span>
      <span class="c1">// Do some custom action.</span>
      <span class="c1">// For example, publish a stop message to some other nodes.</span>

      <span class="c1">// All the default sigint handler does is call shutdown()</span>
     <span class="n">ros</span><span class="o">::</span><span class="n">shutdown</span><span class="p">();</span>
   <span class="p">}</span>

   <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
   <span class="p">{</span>
     <span class="n">ros</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="s">&quot;my_node_name&quot;</span><span class="p">);</span>
     <span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span> <span class="n">nh</span><span class="p">;</span>

     <span class="c1">// Override the default ros sigint handler.</span>
     <span class="c1">// This must be set after the first NodeHandle is created.</span>
     <span class="n">signal</span><span class="p">(</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">mySigintHandler</span><span class="p">);</span>

     <span class="c1">//...</span>
     <span class="n">ros</span><span class="o">::</span><span class="n">spin</span><span class="p">();</span>
     <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
   <span class="p">}</span>
</code></pre></div>
<p><code>roscpp</code> provides some built-in support for calling callbacks from multiple threads. There are two built-in options for this:</p>

<blockquote>
<p>ros::MultiThreadedSpinner</p>
</blockquote>

<p><code>MultiThreadedSpinner</code> is a blocking spinner, similar to <code>ros::spin()</code>. You can specify a number of threads in its constructor, 
but if unspecified (or set to 0), it will use a thread for each CPU core.</p>
<div class="highlight"><pre><code class="language-c++" data-lang="c++">   <span class="n">ros</span><span class="o">::</span><span class="n">MultiThreadedSpinner</span> <span class="n">spinner</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// Use 4 threads</span>
   <span class="n">spinner</span><span class="p">.</span><span class="n">spin</span><span class="p">();</span> <span class="c1">// spin() will not return until the node has been shutdown</span>

   <span class="n">ros</span><span class="o">::</span><span class="n">AsyncSpinner</span> <span class="p">(</span><span class="k">new</span> <span class="n">in</span> <span class="mf">0.10</span><span class="p">)</span>
</code></pre></div>
<p>A more useful threaded spinner is the AsyncSpinner. Instead of a blocking spin() call, it has start() and stop() calls, 
and will automatically stop when it is destroyed. An equivalent use of AsyncSpinner to the MultiThreadedSpinner example above, is:
<code>c++
   1 ros::AsyncSpinner spinner(4); // Use 4 threads
   2 spinner.start();
   3 ros::waitForShutdown();
</code></p>

<p><a href="http://wiki.ros.org/image_transport/Tutorials/PublishingImages">Publishing Images</a>
   ```c++
   #include <ros/ros.h>
   #include <image_transport/image_transport.h>
   #include <opencv2/highgui/highgui.hpp>
   #include <cv_bridge/cv_bridge.h></p>

<p>int main(int argc, char** argv)
   {
      ros::init(argc, argv, &quot;image<em>publisher&quot;);
      ros::NodeHandle nh;
     image</em>transport::ImageTransport it(nh);
     image<em>transport::Publisher pub = it.advertise(&quot;camera/image&quot;, 1);
     cv::Mat image = cv::imread(argv[1], CV</em>LOAD<em>IMAGE</em>COLOR);
     cv::waitKey(30);
     sensor<em>msgs::ImagePtr msg = cv</em>bridge::CvImage(std<em>msgs::Header(), &quot;bgr8&quot;, image).toImageMsg(); /**We load a user-specified
   (on the command line) color image from disk using OpenCV, then convert it to the ROS type sensor</em>msgs/Image.**/</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"> ros::Rate loop_rate(5);
 while (nh.ok()) {
   pub.publish(msg);    /*We broadcast the image to anyone connected to one of our topics, 
                            exactly as we would have using a ros::Publisher.*/
   ros::spinOnce();
   loop_rate.sleep();
 }
</code></pre></div>
<p>}
  ```</p>

<p><strong>Adding video stream from a webcam</strong></p>

<p>The example above requires a path of an image file to be added as a command line parameter
<code>c++ 
cv::imread(argv[1], 
  CV_LOAD_IMAGE_COLOR) 
</code>. 
  This image will be converted and send as a message to an image subscriber. In most cases 
however this is not a very practical example since often you are required to handle streaming data 
(for example: multiple webcameras mounted on a robot record the scene around it and you have to pass the image date 
  to some other node for further analysis). You can modify the example quite easily to make it work with a video device 
supported by <code>cv::VideoCapture</code> (in case it is not you have to handle it accordingly):</p>
<div class="highlight"><pre><code class="language-c++" data-lang="c++"><span class="cp">#include &lt;ros/ros.h&gt;</span>
<span class="cp">#include &lt;image_transport/image_transport.h&gt;</span>
<span class="cp">#include &lt;opencv2/highgui/highgui.hpp&gt;</span>
<span class="cp">#include &lt;cv_bridge/cv_bridge.h&gt;</span>
<span class="cp">#include &lt;sstream&gt; </span><span class="c1">// for converting the command line parameter to integer</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Check if video source has been passed as a parameter</span>
  <span class="k">if</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

  <span class="n">ros</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="s">&quot;image_publisher&quot;</span><span class="p">);</span>
  <span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span> <span class="n">nh</span><span class="p">;</span>
  <span class="n">image_transport</span><span class="o">::</span><span class="n">ImageTransport</span> <span class="n">it</span><span class="p">(</span><span class="n">nh</span><span class="p">);</span>
  <span class="n">image_transport</span><span class="o">::</span><span class="n">Publisher</span> <span class="n">pub</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">advertise</span><span class="p">(</span><span class="s">&quot;camera/image&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

  <span class="c1">// Convert the passed as command line parameter index for the video device to an integer</span>
  <span class="n">std</span><span class="o">::</span><span class="n">istringstream</span> <span class="n">video_sourceCmd</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="kt">int</span> <span class="n">video_source</span><span class="p">;</span>
  <span class="c1">// Check if it is indeed a number</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">video_sourceCmd</span> <span class="o">&gt;&gt;</span> <span class="n">video_source</span><span class="p">))</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

  <span class="n">cv</span><span class="o">::</span><span class="n">VideoCapture</span> <span class="n">cap</span><span class="p">(</span><span class="n">video_source</span><span class="p">);</span>
  <span class="c1">// Check if video device can be opened with the given index</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">cap</span><span class="p">.</span><span class="n">isOpened</span><span class="p">())</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">frame</span><span class="p">;</span>
  <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">ImagePtr</span> <span class="n">msg</span><span class="p">;</span>

  <span class="n">ros</span><span class="o">::</span><span class="n">Rate</span> <span class="n">loop_rate</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">nh</span><span class="p">.</span><span class="n">ok</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">cap</span> <span class="o">&gt;&gt;</span> <span class="n">frame</span><span class="p">;</span>
    <span class="c1">// Check if grabbed frame is actually full with some content</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">frame</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">msg</span> <span class="o">=</span> <span class="n">cv_bridge</span><span class="o">::</span><span class="n">CvImage</span><span class="p">(</span><span class="n">std_msgs</span><span class="o">::</span><span class="n">Header</span><span class="p">(),</span> <span class="s">&quot;bgr8&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="p">).</span><span class="n">toImageMsg</span><span class="p">();</span>
      <span class="n">pub</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
      <span class="n">cv</span><span class="o">::</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">ros</span><span class="o">::</span><span class="n">spinOnce</span><span class="p">();</span>
    <span class="n">loop_rate</span><span class="p">.</span><span class="n">sleep</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre><code class="language-c++" data-lang="c++"><span class="cm">/**Writing a Simple Image Subscriber**/</span>
<span class="cp">#include &lt;ros/ros.h&gt;</span>
<span class="cp">#include &lt;image_transport/image_transport.h&gt;  </span><span class="c1">//image_transport/image_transport.h includes everything we need to publish and subscribe to images.</span>
<span class="cp">#include &lt;opencv2/highgui/highgui.hpp&gt;</span>
<span class="cp">#include &lt;cv_bridge/cv_bridge.h&gt;</span>
<span class="c1">//These headers will allow us to display images using OpenCV&#39;s simple GUI capabilities.</span>

<span class="kt">void</span> <span class="nf">imageCallback</span><span class="p">(</span><span class="k">const</span> <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">ImageConstPtr</span><span class="o">&amp;</span> <span class="n">msg</span><span class="p">)</span>  <span class="c1">//This is the callback function that will get called when a new image has arrived on the &quot;camera/image&quot; topic</span>
<span class="p">{</span>
  <span class="n">try</span>
  <span class="p">{</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">imshow</span><span class="p">(</span><span class="s">&quot;view&quot;</span><span class="p">,</span> <span class="n">cv_bridge</span><span class="o">::</span><span class="n">toCvShare</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s">&quot;bgr8&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">image</span><span class="p">);</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">cv_bridge</span><span class="o">::</span><span class="n">Exception</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">ROS_ERROR</span><span class="p">(</span><span class="s">&quot;Could not convert from &#39;%s&#39; to &#39;bgr8&#39;.&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">encoding</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
  <span class="p">}</span>
  <span class="cm">/*The body of the callback. We convert the ROS image message to an OpenCV image </span>
<span class="cm">  with BGR pixel encoding, then show it in a display window. */</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">ros</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="s">&quot;image_listener&quot;</span><span class="p">);</span>
  <span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span> <span class="n">nh</span><span class="p">;</span>
  <span class="n">cv</span><span class="o">::</span><span class="n">namedWindow</span><span class="p">(</span><span class="s">&quot;view&quot;</span><span class="p">);</span>    <span class="c1">//Create an OpenCV display window.</span>
  <span class="n">cv</span><span class="o">::</span><span class="n">startWindowThread</span><span class="p">();</span>  <span class="c1">//We create an ImageTransport instance, initializing it with our NodeHandle. </span>
  <span class="n">image_transport</span><span class="o">::</span><span class="n">ImageTransport</span> <span class="n">it</span><span class="p">(</span><span class="n">nh</span><span class="p">);</span>  <span class="c1">//We use methods of ImageTransport to create image publishers and subscribers,</span>
  <span class="n">ros</span><span class="o">::</span><span class="n">spin</span><span class="p">();</span>
  <span class="n">cv</span><span class="o">::</span><span class="n">destroyWindow</span><span class="p">(</span><span class="s">&quot;view&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3>Converting ROS image messages to OpenCV images</h3>

<p>CvBridge defines a CvImage type containing an OpenCV image, its encoding and a ROS header. CvImage contains exactly the 
information sensor_msgs/Image does, so we can convert either representation to the other. CvImage class format:</p>
<div class="highlight"><pre><code class="language-c++" data-lang="c++"><span class="k">namespace</span> <span class="n">cv_bridge</span> <span class="p">{</span>

<span class="k">class</span> <span class="nc">CvImage</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">std_msgs</span><span class="o">::</span><span class="n">Header</span> <span class="n">header</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">encoding</span><span class="p">;</span>
  <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">image</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">CvImage</span><span class="o">&gt;</span> <span class="n">CvImagePtr</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">CvImage</span> <span class="k">const</span><span class="o">&gt;</span> <span class="n">CvImageConstPtr</span><span class="p">;</span>

<span class="p">}</span>

<span class="cm">/************************************************************************************************************</span>
<span class="cm">*When converting a ROS sensor_msgs/Image message into a CvImage, CvBridge recognizes two distinct use cases:</span>
<span class="cm">*</span>
<span class="cm">*We want to modify the data in-place. We have to make a copy of the ROS message data.</span>
<span class="cm">*We won&#39;t modify the data. We can safely share the data owned by the ROS message instead of copying.</span>
<span class="cm">*CvBridge provides the following functions for converting to CvImage:</span>
<span class="cm">*************************************************************************************************************/</span>

<span class="c1">// Case 1: Always copy, returning a mutable CvImage</span>
<span class="n">CvImagePtr</span> <span class="n">toCvCopy</span><span class="p">(</span><span class="k">const</span> <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">ImageConstPtr</span><span class="o">&amp;</span> <span class="n">source</span><span class="p">,</span>
                    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">encoding</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">());</span>
<span class="n">CvImagePtr</span> <span class="nf">toCvCopy</span><span class="p">(</span><span class="k">const</span> <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">Image</span><span class="o">&amp;</span> <span class="n">source</span><span class="p">,</span>
                    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">encoding</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">());</span>

<span class="c1">// Case 2: Share if possible, returning a const CvImage</span>
<span class="n">CvImageConstPtr</span> <span class="nf">toCvShare</span><span class="p">(</span><span class="k">const</span> <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">ImageConstPtr</span><span class="o">&amp;</span> <span class="n">source</span><span class="p">,</span>
                          <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">encoding</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">());</span>
<span class="n">CvImageConstPtr</span> <span class="nf">toCvShare</span><span class="p">(</span><span class="k">const</span> <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">Image</span><span class="o">&amp;</span> <span class="n">source</span><span class="p">,</span>
                          <span class="k">const</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="kt">void</span> <span class="k">const</span><span class="o">&gt;&amp;</span> <span class="n">tracked_object</span><span class="p">,</span>
                          <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">encoding</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">());</span>

<span class="cm">/******Converting OpenCV images to ROS image messages******/</span>
<span class="c1">//To convert a CvImage into a ROS image message, use one the toImageMsg() member function:</span>


<span class="k">class</span> <span class="nc">CvImage</span>
<span class="p">{</span>
  <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">ImagePtr</span> <span class="n">toImageMsg</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

  <span class="c1">// Overload mainly intended for aggregate messages that contain</span>
  <span class="c1">// a sensor_msgs::Image as a member.</span>
  <span class="kt">void</span> <span class="n">toImageMsg</span><span class="p">(</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">Image</span><span class="o">&amp;</span> <span class="n">ros_image</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/***Image Transport**************************************************************************</span>
<span class="cm">*image_transport should always be used to publish and subscribe to images. </span>
<span class="cm">*At this basic level of usage, it is very similar to using ROS Publishers and Subscribers. </span>
<span class="cm">*Using image_transport instead of the ROS primitives, however, gives you great flexibility in </span>
<span class="cm">*how images are communicated between nodes.</span>
<span class="cm">*</span>
<span class="cm">*</span>
<span class="cm">***********************************************************************************************/</span>
<span class="c1">// Use the image_transport classes instead.</span>
<span class="c1">//Instead of:</span>
<span class="c1">// Do not communicate images this way!</span>
<span class="cp">#include &lt;ros/ros.h&gt;</span>

<span class="kt">void</span> <span class="nf">imageCallback</span><span class="p">(</span><span class="k">const</span> <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">ImageConstPtr</span><span class="o">&amp;</span> <span class="n">msg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span> <span class="n">nh</span><span class="p">;</span>
<span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span> <span class="n">sub</span> <span class="o">=</span> <span class="n">nh</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">&quot;in_image_topic&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">imageCallback</span><span class="p">);</span>
<span class="n">ros</span><span class="o">::</span><span class="n">Publisher</span> <span class="n">pub</span> <span class="o">=</span> <span class="n">nh</span><span class="p">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">Image</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;out_image_topic&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>


<span class="c1">//Do</span>
<span class="c1">// Use the image_transport classes instead.</span>
<span class="cp">#include &lt;ros/ros.h&gt;</span>
<span class="cp">#include &lt;image_transport/image_transport.h&gt;</span>

<span class="kt">void</span> <span class="nf">imageCallback</span><span class="p">(</span><span class="k">const</span> <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">ImageConstPtr</span><span class="o">&amp;</span> <span class="n">msg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span> <span class="n">nh</span><span class="p">;</span>
<span class="n">image_transport</span><span class="o">::</span><span class="n">ImageTransport</span> <span class="n">it</span><span class="p">(</span><span class="n">nh</span><span class="p">);</span>
<span class="n">image_transport</span><span class="o">::</span><span class="n">Subscriber</span> <span class="n">sub</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">&quot;in_image_base_topic&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">imageCallback</span><span class="p">);</span>
<span class="n">image_transport</span><span class="o">::</span><span class="n">Publisher</span> <span class="n">pub</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="n">advertise</span><span class="p">(</span><span class="s">&quot;out_image_base_topic&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</code></pre></div>
<h3>Run catkin_make on a particular package</h3>
<div class="highlight"><pre><code class="language-text" data-lang="text">catkin_make -DCATKIN_WHITELIST_PACKAGES=&quot;hector_mapping people_tracking_filter cob_people_detection cob_openni2_tracker cob_image_flip cob_leg_detection kinect2_viewer kinect2_calibration kinect2_bridge hector_trajectory_server&quot;
</code></pre></div>
<h3>launching rviz</h3>

<p><a href="#rosrun%20rviz%20rviz%20-d%20%60rospack%20find%20turtle_tf%60/rviz/turtle_rviz.rviz">Launch rviz on an example application</a></p>

<p><code>rosbag record —output-name=laserbag —all —bz2</code></p>

<p>You can play it back using: 
    <code>rosbag play laserbag —loop</code></p>
<div class="highlight"><pre><code class="language-text" data-lang="text">`rosrun rqt_reconfigure rqt_reconfigure`
</code></pre></div>
  </article>

  <!-- mathjax -->
  
  
  
  <!-- disqus comments -->
 
 <div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'patmeansnoble'; // required: replace example with your forum shortname
      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  

</div>

     <!--<nav class="nav-primary" role="navigation" >
    <ul>
        
        <li>
        	 <a class= "post-link" href=""></a>
        </li>
        
        <li>
        	 <a class= "post-link" href=""></a>
        </li>
        
        <li>
        	 <a class= "post-link" href=""></a>
        </li>
        
        <li>
        	 <a class= "post-link" href=""></a>
        </li>
        
    </ul>
</nav>-->
      </div>
    </div>

    <footer class="site-footer">

  <div class="wrap">

    <!-- <h2 class="footer-heading">Olalekan Ogunmolu</h2> -->

    <div class="footer-col-1 column">
      <ul>
        <li>Olalekan Ogunmolu</li>
        <li><a href="mailto:"></a></li> 
      </ul>
    </div>

    <div class="footer-col-2 column">
      <ul>
        <li>
          <a href="https://github.com/lakehanne">
            <span class="icon github">
              <svg version="1.1" class="github-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                <path fill-rule="evenodd" clip-rule="evenodd" fill="#C2C2C2" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
                c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
                c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
                c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
                C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
                c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
                c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
                c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
                c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>
            <span class="username">lakehanne</span>
          </a>
        </li>
        <li>
          <a href="https://twitter.com/patmeansnoble">
            <span class="icon twitter">
              <svg version="1.1" class="twitter-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                <path fill="#C2C2C2" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27
                c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767
                c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206
                C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271
                c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469
                c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
              </svg>
            </span>
            <span class="username">patmeansnoble</span>
          </a>
        </li>
      </ul>
    </div>

    <div class="footer-col-3 column">
      <p class="text">Towards an autonomous future.</p>
    </div>

  </div>

</footer>


    </body>
</html>